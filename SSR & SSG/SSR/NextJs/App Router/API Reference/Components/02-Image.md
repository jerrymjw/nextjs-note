# <Image>

<details data-immersive-translate-effect="1" data-immersive-translate-mark="1" style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: var(--accents-2); --tw-border-spacing-x:0; --tw-border-spacing-y:0; --tw-translate-x:0; --tw-translate-y:0; --tw-rotate:0; --tw-skew-x:0; --tw-skew-y:0; --tw-scale-x:1; --tw-scale-y:1; --tw-pan-x: ; --tw-pan-y: ; --tw-pinch-zoom: ; --tw-scroll-snap-strictness:proximity; --tw-ordinal: ; --tw-slashed-zero: ; --tw-numeric-figure: ; --tw-numeric-spacing: ; --tw-numeric-fraction: ; --tw-ring-inset: ; --tw-ring-offset-width:0px; --tw-ring-offset-color:#fff; --tw-ring-color:rgba(59,130,246,0.5); --tw-ring-offset-shadow:0 0 #0000; --tw-ring-shadow:0 0 #0000; --tw-shadow:0 0 #0000; --tw-shadow-colored:0 0 #0000; --tw-blur: ; --tw-brightness: ; --tw-contrast: ; --tw-grayscale: ; --tw-hue-rotate: ; --tw-invert: ; --tw-saturate: ; --tw-sepia: ; --tw-drop-shadow: ; --tw-backdrop-blur: ; --tw-backdrop-brightness: ; --tw-backdrop-contrast: ; --tw-backdrop-grayscale: ; --tw-backdrop-hue-rotate: ; --tw-backdrop-invert: ; --tw-backdrop-opacity: ; --tw-backdrop-saturate: ; --tw-backdrop-sepia: ; color: rgb(51, 51, 51); font-family: Inter, -apple-system, &quot;system-ui&quot;, &quot;Segoe UI&quot;, Roboto, Oxygen, Ubuntu, Cantarell, &quot;Fira Sans&quot;, &quot;Droid Sans&quot;, &quot;Helvetica Neue&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"><summary data-immersive-translate-effect="1" data-immersive-translate-mark="1" style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: var(--accents-2); --tw-border-spacing-x:0; --tw-border-spacing-y:0; --tw-translate-x:0; --tw-translate-y:0; --tw-rotate:0; --tw-skew-x:0; --tw-skew-y:0; --tw-scale-x:1; --tw-scale-y:1; --tw-pan-x: ; --tw-pan-y: ; --tw-pinch-zoom: ; --tw-scroll-snap-strictness:proximity; --tw-ordinal: ; --tw-slashed-zero: ; --tw-numeric-figure: ; --tw-numeric-spacing: ; --tw-numeric-fraction: ; --tw-ring-inset: ; --tw-ring-offset-width:0px; --tw-ring-offset-color:#fff; --tw-ring-color:rgba(59,130,246,0.5); --tw-ring-offset-shadow:0 0 #0000; --tw-ring-shadow:0 0 #0000; --tw-shadow:0 0 #0000; --tw-shadow-colored:0 0 #0000; --tw-blur: ; --tw-brightness: ; --tw-contrast: ; --tw-grayscale: ; --tw-hue-rotate: ; --tw-invert: ; --tw-saturate: ; --tw-sepia: ; --tw-drop-shadow: ; --tw-backdrop-blur: ; --tw-backdrop-brightness: ; --tw-backdrop-contrast: ; --tw-backdrop-grayscale: ; --tw-backdrop-hue-rotate: ; --tw-backdrop-invert: ; --tw-backdrop-opacity: ; --tw-backdrop-saturate: ; --tw-backdrop-sepia: ; display: list-item; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); cursor: pointer; font-weight: 600; user-select: none;"><b data-immersive-translate-effect="1" data-immersive-translate-mark="1" style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: var(--accents-2); --tw-border-spacing-x:0; --tw-border-spacing-y:0; --tw-translate-x:0; --tw-translate-y:0; --tw-rotate:0; --tw-skew-x:0; --tw-skew-y:0; --tw-scale-x:1; --tw-scale-y:1; --tw-pan-x: ; --tw-pan-y: ; --tw-pinch-zoom: ; --tw-scroll-snap-strictness:proximity; --tw-ordinal: ; --tw-slashed-zero: ; --tw-numeric-figure: ; --tw-numeric-spacing: ; --tw-numeric-fraction: ; --tw-ring-inset: ; --tw-ring-offset-width:0px; --tw-ring-offset-color:#fff; --tw-ring-color:rgba(59,130,246,0.5); --tw-ring-offset-shadow:0 0 #0000; --tw-ring-shadow:0 0 #0000; --tw-shadow:0 0 #0000; --tw-shadow-colored:0 0 #0000; --tw-blur: ; --tw-brightness: ; --tw-contrast: ; --tw-grayscale: ; --tw-hue-rotate: ; --tw-invert: ; --tw-saturate: ; --tw-sepia: ; --tw-drop-shadow: ; --tw-backdrop-blur: ; --tw-backdrop-brightness: ; --tw-backdrop-contrast: ; --tw-backdrop-grayscale: ; --tw-backdrop-hue-rotate: ; --tw-backdrop-invert: ; --tw-backdrop-opacity: ; --tw-backdrop-saturate: ; --tw-backdrop-sepia: ; font-weight: bolder;">Examples</b></summary><ul data-immersive-translate-effect="1" data-immersive-translate-mark="1" style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: var(--accents-2); --tw-border-spacing-x:0; --tw-border-spacing-y:0; --tw-translate-x:0; --tw-translate-y:0; --tw-rotate:0; --tw-skew-x:0; --tw-skew-y:0; --tw-scale-x:1; --tw-scale-y:1; --tw-pan-x: ; --tw-pan-y: ; --tw-pinch-zoom: ; --tw-scroll-snap-strictness:proximity; --tw-ordinal: ; --tw-slashed-zero: ; --tw-numeric-figure: ; --tw-numeric-spacing: ; --tw-numeric-fraction: ; --tw-ring-inset: ; --tw-ring-offset-width:0px; --tw-ring-offset-color:#fff; --tw-ring-color:rgba(59,130,246,0.5); --tw-ring-offset-shadow:0 0 #0000; --tw-ring-shadow:0 0 #0000; --tw-shadow:0 0 #0000; --tw-shadow-colored:0 0 #0000; --tw-blur: ; --tw-brightness: ; --tw-contrast: ; --tw-grayscale: ; --tw-hue-rotate: ; --tw-invert: ; --tw-saturate: ; --tw-sepia: ; --tw-drop-shadow: ; --tw-backdrop-blur: ; --tw-backdrop-brightness: ; --tw-backdrop-contrast: ; --tw-backdrop-grayscale: ; --tw-backdrop-hue-rotate: ; --tw-backdrop-invert: ; --tw-backdrop-opacity: ; --tw-backdrop-saturate: ; --tw-backdrop-sepia: ; list-style: none; margin: 1.25em 0px; padding: 0px 0px 0px 12px;"><li data-immersive-translate-effect="1" data-immersive-translate-mark="1" style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: var(--accents-2); --tw-border-spacing-x:0; --tw-border-spacing-y:0; --tw-translate-x:0; --tw-translate-y:0; --tw-rotate:0; --tw-skew-x:0; --tw-skew-y:0; --tw-scale-x:1; --tw-scale-y:1; --tw-pan-x: ; --tw-pan-y: ; --tw-pinch-zoom: ; --tw-scroll-snap-strictness:proximity; --tw-ordinal: ; --tw-slashed-zero: ; --tw-numeric-figure: ; --tw-numeric-spacing: ; --tw-numeric-fraction: ; --tw-ring-inset: ; --tw-ring-offset-width:0px; --tw-ring-offset-color:#fff; --tw-ring-color:rgba(59,130,246,0.5); --tw-ring-offset-shadow:0 0 #0000; --tw-ring-shadow:0 0 #0000; --tw-shadow:0 0 #0000; --tw-shadow-colored:0 0 #0000; --tw-blur: ; --tw-brightness: ; --tw-contrast: ; --tw-grayscale: ; --tw-hue-rotate: ; --tw-invert: ; --tw-saturate: ; --tw-sepia: ; --tw-drop-shadow: ; --tw-backdrop-blur: ; --tw-backdrop-brightness: ; --tw-backdrop-contrast: ; --tw-backdrop-grayscale: ; --tw-backdrop-hue-rotate: ; --tw-backdrop-invert: ; --tw-backdrop-opacity: ; --tw-backdrop-saturate: ; --tw-backdrop-sepia: ; margin-top: 0.5em; margin-bottom: 0.5em; padding-left: 12px;"><a href="https://github.com/vercel/next.js/tree/canary/examples/image-component" rel="noopener noreferrer" target="_blank" data-immersive-translate-effect="1" data-immersive-translate-mark="1" style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: var(--accents-2); --tw-border-spacing-x:0; --tw-border-spacing-y:0; --tw-translate-x:0; --tw-translate-y:0; --tw-rotate:0; --tw-skew-x:0; --tw-skew-y:0; --tw-scale-x:1; --tw-scale-y:1; --tw-pan-x: ; --tw-pan-y: ; --tw-pinch-zoom: ; --tw-scroll-snap-strictness:proximity; --tw-ordinal: ; --tw-slashed-zero: ; --tw-numeric-figure: ; --tw-numeric-spacing: ; --tw-numeric-fraction: ; --tw-ring-inset: ; --tw-ring-offset-width:0px; --tw-ring-offset-color:#fff; --tw-ring-color:rgba(59,130,246,0.5); --tw-ring-offset-shadow:0 0 #0000; --tw-ring-shadow:0 0 #0000; --tw-shadow:0 0 #0000; --tw-shadow-colored:0 0 #0000; --tw-blur: ; --tw-brightness: ; --tw-contrast: ; --tw-grayscale: ; --tw-hue-rotate: ; --tw-invert: ; --tw-saturate: ; --tw-sepia: ; --tw-drop-shadow: ; --tw-backdrop-blur: ; --tw-backdrop-brightness: ; --tw-backdrop-contrast: ; --tw-backdrop-grayscale: ; --tw-backdrop-hue-rotate: ; --tw-backdrop-invert: ; --tw-backdrop-opacity: ; --tw-backdrop-saturate: ; --tw-backdrop-sepia: ; color: var(--tw-prose-links); text-decoration: none; transition: color 0.2s ease 0s; touch-action: pan-y; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-weight: inherit;"><span class="inline-flex" style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: var(--accents-2); --tw-border-spacing-x:0; --tw-border-spacing-y:0; --tw-translate-x:0; --tw-translate-y:0; --tw-rotate:0; --tw-skew-x:0; --tw-skew-y:0; --tw-scale-x:1; --tw-scale-y:1; --tw-pan-x: ; --tw-pan-y: ; --tw-pinch-zoom: ; --tw-scroll-snap-strictness:proximity; --tw-ordinal: ; --tw-slashed-zero: ; --tw-numeric-figure: ; --tw-numeric-spacing: ; --tw-numeric-fraction: ; --tw-ring-inset: ; --tw-ring-offset-width:0px; --tw-ring-offset-color:#fff; --tw-ring-color:rgba(59,130,246,0.5); --tw-ring-offset-shadow:0 0 #0000; --tw-ring-shadow:0 0 #0000; --tw-shadow:0 0 #0000; --tw-shadow-colored:0 0 #0000; --tw-blur: ; --tw-brightness: ; --tw-contrast: ; --tw-grayscale: ; --tw-hue-rotate: ; --tw-invert: ; --tw-saturate: ; --tw-sepia: ; --tw-drop-shadow: ; --tw-backdrop-blur: ; --tw-backdrop-brightness: ; --tw-backdrop-contrast: ; --tw-backdrop-grayscale: ; --tw-backdrop-hue-rotate: ; --tw-backdrop-invert: ; --tw-backdrop-opacity: ; --tw-backdrop-saturate: ; --tw-backdrop-sepia: ; display: inline-flex;"><svg data-testid="geist-icon" fill="none" height="14" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="14" style="color:currentColor"><path d="M7 17L17 7"></path><path d="M7 7h10v10"></path></svg></span></a></li></ul></details>

此 API 参考将帮助您了解如何使用图像组件可用的 props 和配置选项。有关功能和用法，请参阅图像组件页面。

```js
import Image from 'next/image';
 
export default function Page() {
  return (
    <Image
      src="/profile.png"
      width={500}
      height={500}
      alt="Picture of the author"
    />
  );
}
```

## [Props](https://nextjs.org/docs/app/api-reference/components/image#props)

以下是可用于图像组件的属性摘要：

![image-20230526100753323](/Users/jerry/Library/Application Support/typora-user-images/image-20230526100753323.png)

## [Required Props](https://nextjs.org/docs/app/api-reference/components/image#required-props)

图像组件需要以下属性： `src` 、 `width` 、 `height` 和 `alt` 。

```js
import Image from 'next/image';
 
export default function Page() {
  return (
    <div>
      <Image
        src="/profile.png"
        width={500}
        height={500}
        alt="Picture of the author"
      />
    </div>
  );
}
```

### [`src`](https://nextjs.org/docs/app/api-reference/components/image#src)

Must be one of the following:
必须是以下之一：

1. 静态导入的图像文件，或
2. 路径字符串。这可以是绝对外部 URL，也可以是内部路径，具体取决于加载程序属性。

使用外部 URL 时，必须将其添加到 `next.config.js` 中的远程模式。

### [`width`](https://nextjs.org/docs/app/api-reference/components/image#width)

`width` 属性表示呈现的宽度（以像素为单位），因此它会影响图像的显示大小。

必需，静态导入的图像或具有 `fill` 属性的图像除外。

### [`height`](https://nextjs.org/docs/app/api-reference/components/image#height)

`height` 属性表示呈现的高度（以像素为单位），因此它会影响图像的显示大小。

Required, except for [statically imported images](https://nextjs.org/docs/app/building-your-application/optimizing/images#local-images) or images with the 必需，静态导入的图像或具有 `fill` 属性的图像除外。

### [`alt`](https://nextjs.org/docs/app/api-reference/components/image#alt)

`alt` 属性用于描述屏幕阅读器和搜索引擎的图像。如果图像已被禁用或在加载图像时发生错误，它也是回退文本。

它应该包含可以在不更改页面含义的情况下替换图像的文本。它不是为了补充图像，也不应重复图像上方或下方标题中已提供的信息。

如果图像纯粹是装饰性的或不是为用户准备的， `alt` 属性应该是一个空字符串 （ `alt=""` ）。

## [Optional Props](https://nextjs.org/docs/app/api-reference/components/image#optional-props)

The `<Image />` component accepts a number of additional properties beyond those which are required. This section describes the most commonly-used properties of the Image component. Find details about more rarely-used properties in the [Advanced Props](https://nextjs.org/docs/app/api-reference/components/image#advanced-props) section.
`<Image />` 组件接受除所需属性之外的许多其他属性。本节介绍图像组件最常用的属性。在高级道具部分查找有关更多很少使用的属性的详细信息。

### [`loader`](https://nextjs.org/docs/app/api-reference/components/image#loader)

用于解析图像网址的自定义函数。

`loader` 是一个函数，在给定以下参数的情况下返回图像的 URL 字符串：

- [`src`](https://nextjs.org/docs/app/api-reference/components/image#src)
- [`width`](https://nextjs.org/docs/app/api-reference/components/image#width)
- [`quality`](https://nextjs.org/docs/app/api-reference/components/image#quality)

下面是使用自定义加载程序的示例：

```js
import Image from 'next/image';
 
const imageLoader = ({ src, width, quality }) => {
  return `https://example.com/${src}?w=${width}&q=${quality || 75}`;
};
 
export default function Page() {
  return (
    <Image
      loader={imageLoader}
      src="me.png"
      alt="Picture of the author"
      width={500}
      height={500}
    />
  );
}
```

或者，可以使用 `next.config.js` 中的 loaderFile 配置来配置应用程序中 `next/image` 的每个实例，而无需传递 prop。

### [`fill`](https://nextjs.org/docs/app/api-reference/components/image#fill)

```js
fill={true} // {true} | {false}
```

一个布尔值，它使图像填充父元素而不是设置 `width` 和 `height` 。

父元素必须指定 `position: "relative"` 、 `position: "fixed"` 或 `position: "absolute"` 样式。

默认情况下，img 元素将自动分配 `position: "absolute"` 样式。

默认的图像适合行为将拉伸图像以适合容器。您可能更喜欢为加黑边的图像设置 `object-fit: "contain"` 以适合容器并保留纵横比。

或者， `object-fit: "cover"` 将导致图像填充整个容器并被裁剪以保留纵横比。为了使它看起来正确，应将 `overflow: "hidden"` 样式分配给父元素。

For more information, see also: 有关更多信息，另请参阅：

- [`position`](https://developer.mozilla.org/en-US/docs/Web/CSS/position)
- [`object-fit`](https://developer.mozilla.org/en-US/docs/Web/CSS/object-fit)
- [`object-position`](https://developer.mozilla.org/en-US/docs/Web/CSS/object-position)

### [`sizes`](https://nextjs.org/docs/app/api-reference/components/image#sizes)

一个字符串，提供有关图像在不同断点处的宽度的信息。 `sizes` 的值将极大地影响使用 `fill` 或样式设置为具有响应大小的图像的性能。

`sizes` 属性用于与图像性能相关的两个重要用途：

- 首先，浏览器使用 `sizes` 的值来确定要从 `next/image` 自动生成的源集中下载的图像大小。当浏览器选择时，它还不知道页面上图像的大小，因此它会选择与视口大小相同或更大的图像。 `sizes` 属性允许您告诉浏览器图像实际上将小于全屏。如果未在具有 `fill` 属性的图像中指定 `sizes` 值，则使用默认值 `100vw` （全屏宽度）。
- 其次， `sizes` 属性配置 `next/image` 自动生成图像源集的方式。如果不存在 `sizes` 值，则会生成适用于固定大小图像的小型源集。如果定义了 `sizes` ，则会生成适用于响应式图像的大型源集。如果 `sizes` 属性包含诸如 `50vw` 之类的大小，这些大小表示视区宽度的百分比，则会修剪源集，使其不包含任何太小而不需要的值。

例如，如果您知道样式将导致图像在移动设备上为全屏，在平板电脑上采用 2 列的布局，在桌面显示器上采用 3 列的布局，则应包含如下所示的 size 属性：

```js
import Image from 'next/image';
 
export default function Page() {
  return (
    <div className="grid-element">
      <Image
        fill
        src="/example.png"
        sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
      />
    </div>
  );
}
```

### [`quality`](https://nextjs.org/docs/app/api-reference/components/image#quality)

```
quality={75} // {number 1-100}
```

优化图像的质量，介于 `1` 和 `100` 之间的整数，其中 `100` 是最佳质量，因此文件大小最大。默认为 `75` 。

### [`priority`](https://nextjs.org/docs/app/api-reference/components/image#priority)

```
priority={false} // {false} | {true}
```

如果为 true，则图像将被视为高优先级并预加载。对于使用 `priority` 的图像，将自动禁用延迟加载。

应在检测为最大内容绘制 （LCP） 元素的任何图像上使用 `priority` 属性。具有多个优先级图像可能是合适的，因为不同的图像可能是不同视口大小的 LCP 元素。

应仅在图像在首屏上方可见时使用。默认为 `false` 。

### [`placeholder`](https://nextjs.org/docs/app/api-reference/components/image#placeholder)

```
placeholder = 'empty'; // {empty} | {blur}
```

加载图像时要使用的占位符。可能的值为 `blur` 或 `empty` 。默认为 `empty` 。

当 `blur` 时， `blurDataURL` 属性将用作占位符。如果 `src` 是静态导入的对象，并且导入的图像是 `.jpg` 、 `.png` 、 `.webp` 或 `.avif` ，则 `blurDataURL` 将自动填充。

对于动态图像，必须提供 `blurDataURL` 属性。诸如Plaiceholder之类的解决方案可以帮助生成 `base64` 。

当 `empty` 时，加载图像时将没有占位符，只有空白空间。

## [Advanced Props](https://nextjs.org/docs/app/api-reference/components/image#advanced-props)

在某些情况下，您可能需要更高级的用法。 `<Image />` 组件可以选择接受以下高级属性。

### [`style`](https://nextjs.org/docs/app/api-reference/components/image#style)

允许将 CSS 样式传递到底层图像元素。

```js
const imageStyle = {
  borderRadius: '50%',
  border: '1px solid #fff',
};
 
export default function ProfileImage() {
  return <Image src="..." style={imageStyle} />;
}
```

请记住，所需的宽度和高度属性可以与您的样式交互。如果使用样式来修改图像的宽度，则还应将其高度设置为 `auto` 以保留其固有纵横比，否则图像将失真。

### [`onLoadingComplete`](https://nextjs.org/docs/app/api-reference/components/image#onloadingcomplete)

```
<Image onLoadingComplete={(img) => console.log(img.naturalWidth)} />
```

一个回调函数，在图像完全加载并删除占位符后调用。

回调函数将使用一个参数调用，该参数是对基础 `<img>` 元素的引用。

### [`onLoad`](https://nextjs.org/docs/app/api-reference/components/image#onload)

```
<Image onLoad={(e) => console.log(e.target.naturalWidth)} />
```

加载图像时调用的回调函数。

请注意，加载事件可能会在删除占位符和完全解码图像之前发生。

请改用 `onLoadingComplete` 。

### [`onError`](https://nextjs.org/docs/app/api-reference/components/image#onerror)

```
<Image onError={(e) => console.error(e.target.id)} />
```

在图像加载失败时调用的回调函数。

### [`loading`](https://nextjs.org/docs/app/api-reference/components/image#loading)

> 建议：此属性仅适用于高级用例。将图像切换为使用 `eager` 加载通常会损害性能。我们建议改用 `priority` 属性，这将急切地预加载图像。

```
loading = 'lazy'; // {lazy} | {eager}
```

图像的加载行为。默认为 `lazy` 。

当 `lazy` 时，延迟加载图像，直到它到达距视口的计算距离。

当 `eager` 时，立即加载图像。

### [`blurDataURL`](https://nextjs.org/docs/app/api-reference/components/image#blurdataurl)

在成功加载 `src` 图像之前用作占位符图像的数据 URL。仅当与 `placeholder="blur"` 结合使用时才会生效。

必须是 base64 编码的图像。它将被放大和模糊，因此建议使用非常小的图像（10px 或更小）。将较大的图像作为占位符包含可能会损害应用程序性能。

### [`unoptimized`](https://nextjs.org/docs/app/api-reference/components/image#unoptimized)

```
unoptimized = {false} // {false} | {true}
```

如果为 true，则源图像将按原样提供，而不是更改质量、大小或格式。默认为 `false` 。

```tsx
import Image from 'next/image';
 
const UnoptimizedImage = (props) => {
  return <Image {...props} unoptimized />;
};
```

从 Next.js 12.3.0 开始，可以通过使用以下配置更新 `next.config.js` 将这个 prop 分配给所有图像：

```js
module.exports = {
  images: {
    unoptimized: true,
  },
};
```

### [Other Props](https://nextjs.org/docs/app/api-reference/components/image#other-props)

`<Image />` 组件上的其他属性将传递给基础 `img` 元素，但以下属性除外：

- `srcSet`. Use [Device Sizes](https://nextjs.org/docs/app/api-reference/components/image#devicesizes) instead.
  `srcSet`. 使用 [Device Sizes](https://nextjs.org/docs/app/api-reference/components/image#devicesizes) 除外。
- `decoding` .它始终是 `"async"` 。

## [Configuration Options 配置选项](https://nextjs.org/docs/app/api-reference/components/image#configuration-options)

除了属性，您还可以在 `next.config.js` 中配置图像组件。以下选项可用：

### [`remotePatterns`](https://nextjs.org/docs/app/api-reference/components/image#remotepatterns)

To protect your application from malicious users, configuration is required in order to use external images. This ensures that only external images from your account can be served from the Next.js Image Optimization API. These external images can be configured with the `remotePatterns` property in your `next.config.js` file, as shown below:
为了保护您的应用程序免受恶意用户的侵害，需要进行配置才能使用外部图像。这可确保只有您帐号中的外部图片才能从下Next.js图片优化 API 提供。可以使用 `next.config.js` 文件中的 `remotePatterns` 属性配置这些外部映像，如下所示：

```js
module.exports = {
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: 'example.com',
        port: '',
        pathname: '/account123/**',
      },
    ],
  },
};
```

> **注意**：上面的示例将确保 `next/image` 的 `src` 属性必须以 `https://example.com/account123/` 开头。任何其他协议、主机名、端口或不匹配的路径都将响应 400 错误请求。

```js
module.exports = {
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: '**.example.com',
      },
    ],
  },
};
```

> **Note**: The example above will ensure the `src` property of `next/image` must start with `https://img1.example.com` or `https://me.avatar.example.com` or any number of subdomains. Any other protocol or unmatched hostname will respond with 400 Bad Request.
> 注意：上面的示例将确保 `next/image` 的 `src` 属性必须以 `https://img1.example.com` 或 `https://me.avatar.example.com` 或任意数量的子域开头。任何其他协议或不匹配的主机名都将响应 400 错误请求。

Wildcard patterns can be used for both `pathname` and `hostname` and have the following syntax:
通配符模式可用于 `pathname` 和 `hostname` ，并具有以下语法：

- `*` match a single path segment or subdomain
  `*` 匹配单个路径段或子域
- `**` match any number of path segments at the end or subdomains at the beginning
  `**` 匹配任意数量的路径段在末尾或子域在开头

The `**` syntax does not work in the middle of the pattern.
`**` 语法在模式中间不起作用。

### [`domains`](https://nextjs.org/docs/app/api-reference/components/image#domains)

> **Warning**: We recommend configuring strict [`remotePatterns`](https://nextjs.org/docs/app/api-reference/components/image#remotepatterns) instead of `domains` in order to protect your application from malicious users. Only use `domains` if you own all the content served from the domain.
> 警告：我们建议配置严格的 `remotePatterns` 而不是 `domains` ，以保护应用程序免受恶意用户的侵害。仅当您拥有域提供的所有内容时，才使用 `domains` 。

Similar to [`remotePatterns`](https://nextjs.org/docs/app/api-reference/components/image#remotepatterns), the `domains` configuration can be used to provide a list of allowed hostnames for external images.
与 `remotePatterns` 类似， `domains` 配置可用于为外部映图像提供允许的主机名列表。

However, the `domains` configuration does not support wildcard pattern matching and it cannot restrict protocol, port, or pathname.
但是， `domains` 配置不支持通配符模式匹配，并且无法限制协议、端口或路径名。

下面是 `next.config.js` 文件中 `domains` 属性的示例：

```js
module.exports = {
  images: {
    domains: ['assets.acme.com'],
  },
};
```

### [`loaderFile`](https://nextjs.org/docs/app/api-reference/components/image#loaderfile)

如果要使用云提供程序来优化映像，而不是使用 Next.js 内置图像优化 API，可以在 `next.config.js` 中配置 `loaderFile` ，如下所示：

```js
module.exports = {
  images: {
    loader: 'custom',
    loaderFile: './my/image/loader.js',
  },
};
```

这必须指向相对于 Next.js 应用程序的根目录的文件。该文件必须导出返回字符串的默认函数，例如：

```js
export default function myImageLoader({ src, width, quality }) {
  return `https://example.com/${src}?w=${width}&q=${quality || 75}`;
}
```

或者，您可以使用 `loader` 属性来配置 `next/image` 的每个实例。

## [Advanced](https://nextjs.org/docs/app/api-reference/components/image#advanced)

以下配置适用于高级用例，通常不是必需的。如果选择配置以下属性，则会在将来的更新中覆盖对 Next.js 默认值所做的任何更改。

### [`deviceSizes`](https://nextjs.org/docs/app/api-reference/components/image#devicesizes)

如果知道用户的预期设备宽度，则可以使用 `next.config.js` 中的 `deviceSizes` 属性指定设备宽度断点列表。当 `next/image` 组件使用 `sizes` 属性以确保为用户设备提供正确的图像时，将使用这些宽度。

If no configuration is provided, the default below is used.
如果未提供配置，则使用下面的默认值。

```js
module.exports = {
  images: {
    deviceSizes: [640, 750, 828, 1080, 1200, 1920, 2048, 3840],
  },
};
```

### [`imageSizes`](https://nextjs.org/docs/app/api-reference/components/image#imagesizes)

可以使用  `next.config.js` 中的 `images.imageSizes` 属性指定图像宽度列表。这些宽度与设备大小数组连接在一起，形成用于生成图像 srcset 的完整大小数组。

有两个单独列表的原因是 imageSize 仅用于提供 `sizes` 属性的图像，这表明图像小于屏幕的整个宽度。因此，imageSizes 中的sizes都应小于deviceSizes.中的最小sizes。

如果未提供配置，则使用下面的默认值。

```js
module.exports = {
  images: {
    imageSizes: [16, 32, 48, 64, 96, 128, 256, 384],
  },
};
```

### [`formats`](https://nextjs.org/docs/app/api-reference/components/image#formats)

默认图像优化 API 将通过请求的 `Accept` header自动检测浏览器支持的图像格式。

如果 `Accept` header匹配多个配置的格式，则使用数组中的第一个匹配项。因此，数组顺序很重要。如果没有匹配项（或源图像已动画化），图像优化 API 将回退到原始图像的格式。

如果未提供配置，则使用下面的默认值。

```js
module.exports = {
  images: {
    formats: ['image/webp'],
  },
};
```

您可以使用以下配置启用 AVIF 支持:

```js
module.exports = {
  images: {
    formats: ['image/avif', 'image/webp'],
  },
};
```

> **注意**：AVIF 通常需要多20% 的编码时间，但与 WebP 相比，它的压缩速度小 20%。这意味着第一次请求图像时，它通常会变慢，然后缓存的后续请求会更快。

> **注意**：如果在 Next.js 前面使用代理/CDN 进行自托管，则必须将代理配置为转发 `Accept` header。

## [Caching Behavior](https://nextjs.org/docs/app/api-reference/components/image#caching-behavior)

下面介绍默认加载程序的缓存算法。对于所有其他加载程序，请参阅云提供商的文档。

图像根据请求动态优化，并存储在 `<distDir>/cache/images` 目录中。优化后的镜像文件将提供给后续请求，直到过期。当发出与缓存但已过期的文件匹配的请求时，过期的图像将立即过时。然后，在后台再次优化图像（也称为重新验证），并使用新的到期日期保存到缓存中。

图像的缓存状态可以通过读取 `x-nextjs-cache` 响应标头的值来确定。可能的值如下：

- `MISS` - 路径不在缓存中（在第一次访问时最多发生一次）
- `STALE` - 路径位于缓存中，但超过了重新验证时间，因此将在后台更新
- `HIT` - 路径位于缓存中，并且未超过重新验证时间

过期时间（或更确切地说是Max Age）由[`minimumCacheTTL`](https://nextjs.org/docs/app/api-reference/components/image#minimumcachettl) 配置或上游映像 `Cache-Control` header定义，以较大者为准。具体而言，使用 `Cache-Control` header的 `max-age` 值。如果同时找到 `s-maxage` 和 `max-age` ，则首选 `s-maxage` 。 `max-age` 还会传递到任何下游客户端，包括 CDN 和浏览器。

- You can configure [`minimumCacheTTL`](https://nextjs.org/docs/app/api-reference/components/image#minimumcachettl) to increase the cache duration when the upstream image does not include `Cache-Control` header or the value is very low.
  可以将 `minimumCacheTTL` 配置为在上游映像不包含 `Cache-Control` 标头或值非常低时增加缓存持续时间。
- 可以配置 [`deviceSizes`](https://nextjs.org/docs/app/api-reference/components/image#devicesizes) 和 [`imageSizes`](https://nextjs.org/docs/app/api-reference/components/image#devicesizes) 以减少可能生成的图像吧总数。
- You can configure [formats](https://nextjs.org/docs/app/api-reference/components/image#formats) to disable multiple formats in favor of a single image format.
  您可以配置[格式 formats](https://nextjs.org/docs/app/api-reference/components/image#formats) 以禁用多种格式以支持单个图像格式

### [`minimumCacheTTL`](https://nextjs.org/docs/app/api-reference/components/image#minimumcachettl)

您可以为缓存的优化映像配置**生存时间 Time to Live**（TTL）（以秒为单位）。在许多情况下，最好使用静态图像导入，它将自动散列文件内容并使用 `immutable` 的 `Cache-Control` header永久缓存图像。

```js
module.exports = {
  images: {
    minimumCacheTTL: 60,
  },
};
```

优化图像的过期时间（或更确切地说是最长期限）由 `minimumCacheTTL` 或上游映像 `Cache-Control` header定义，以较大者为准。

如果需要更改每个图像的缓存行为，可以将 `headers` 配置为在上游映像上设置 `Cache-Controlheader（例如 `/some-asset.jpg` ，而不是 `/_next/image` 本身）。

目前没有使缓存失效的机制，因此最好保持 `minimumCacheTTL` 较低。否则，您可能需要手动更改 `src` 属性或删除 `<distDir>/cache/images` 。

### [`disableStaticImages`](https://nextjs.org/docs/app/api-reference/components/image#disablestaticimages)

默认行为允许导入静态文件（如 `import icon from './icon.png` ），然后将其传递给 `src` 属性。

在某些情况下，如果此功能与期望导入行为不同的其他插件冲突，您可能希望禁用此功能。

您可以在 `next.config.js` 中禁用静态图像导入：

```js
module.exports = {
  images: {
    disableStaticImages: true,
  },
};
```

### [`dangerouslyAllowSVG`](https://nextjs.org/docs/app/api-reference/components/image#dangerouslyallowsvg)

由于几个原因，默认加载程序不会优化 SVG 图像。首先，SVG 是一种矢量格式，这意味着它可以无损调整大小。其次，SVG具有许多与HTML / CSS相同的功能，这可能会导致没有适当内容安全策略（CSP）header的漏洞。

如果需要使用默认的图像优化 API 提供 SVG 图像，可以在 `next.config.js` 中设置 `dangerouslyAllowSVG` ：

```js
module.exports = {
  images: {
    dangerouslyAllowSVG: true,
    contentDispositionType: 'attachment',
    contentSecurityPolicy: "default-src 'self'; script-src 'none'; sandbox;",
  },
};
```

此外，强烈建议还设置 `contentDispositionType` 以强制浏览器下载图像，以及 `contentSecurityPolicy` 以防止嵌入在图像中的脚本执行。

## [Animated Images](https://nextjs.org/docs/app/api-reference/components/image#animated-images)

默认加载程序将自动绕过动画图像的图像优化，并按原样提供图像。

动画文件的自动检测是尽力而为，并支持 GIF、APNG 和 WebP。如果要显式绕过给定动画图像的图像优化，请使用未优化的属性。

